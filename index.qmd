---
title: "הדרכה לחישוב זמני הליכה לתחנות אוטובוס באמצעות qgis - הדרכה לחברת חסון ירושלמי"
author: 'ד"ר עדו קליין'
date: 03/06/2024
format:
  revealjs:
    rtl: true
    css: "style.css"
    slide-number: true
    show-slide-number: all
editor: visual
---

## מי אני?

עדו קליין, מתכנן ומודליסט תחבורה, יועץ לחברת אשד וללקוחות נוספים, ד"ר לגאוגרפיה, חיית טוויטר

```{=html}
<a class="twitter-timeline" href="https://twitter.com/idoklein1?ref_src=twsrc%5Etfw">Tweets by idoklein1</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
```
## מטרות ההדרכה

-   ללמד כיצד מחשבים את המסלול הקצר ביותר בין מוצא ליעד
-   ללמד איך עושים זאת תוך כדי התחשבות בטופוגרפיה
-   להשתמש בצורה נכונה בתוסף qneat
-   לדעת איך להכין רשתות להרצה
-   לדעת איך להוסיף מימד גובה לרשתות
-   לדעת איך לחשב שיפועים באמצעות מנוע הביטויים

## מבוא - למה חשוב למדל זמני הליכה לתחנות אוטובוס?

חשוב כמו כל דבר אחר, בעולם הפעילויות הסמוך לבית. תחנות אוטובוס פשוט מסוגלות להרחיב משמעותית את הנגישות ובכך את האפשרויות של הפרט. אנו יכולים לחשב את הנגישות על ידי מציאת המסלול הקצר ביותר על גבי רשת רחובות מנקודה א אל נקודה ב. מכיוון שאנו עובדים עם מחשב ניתן לבצע את החישוב הזה פעמים רבות על מנת לקבל מפה כוללנית של נגישות.

## חישוב מסלול קצר ביותר - שלל אלגורתמים

דייקסטרה\
A\*\
לא נדון בצד התאורטי של פעולת האלגוריתם, אבל כן נדבר על מה חשוב יותר ופחות מבחינת המידול

## רשת מרחבית

הכלאה של שני יצורים:

-   שכבת קווים ממגית - מורכבת מקווים בלבד
-   רשת מתורת הגרפים - מורכבת מקודקודים וקשתות

## שכבת קווים ממגית

![](images/paste-3.png){width="243"}

## רשת מתורת הגרפים

![מאת User:AzaToth - Image:6n-graf.png simlar input data, נחלת הכלל, https://commons.wikimedia.org/w/index.php?curid=820489](images/paste-4.png){width="666"}

## מה חשוב?

מבחינת ממ"ג:

שכלל השכבות יהיו באותו היטל

מבחינת רשת:

שהרשת תהיה מחוברת. זה תלוי בממ"ג

## מהו חיבור?

נגיעה של ראש/זנב של קו אחד בזנב/ראש של קו אחר. למשל, כאן יש בעייה: ![](images/paste-5.png)

::: hidden
יש לדייק את הרשת. ניתן לבדוק אם הרשת שלמה באמצעות פקודת v.net.components מספרית grass. כאן ניתן לראות כי הרשת אינה שלמה. **Snap geometries to layer**
:::

## רמת המידול

אנחנו יכולים להתייחס לרחוב בתור קו, או לשתי גדות הרחוב בתור קווים, או גם למעברי חצייה, והרשימה לא נגמרת. כיום פחות מקובל להתייחס למעברי חצייה אם כי חשוב - קשה לקנוס אותם בצורה מדויקת דיו. 

## הורדת החומרים

```{r}
library(downloadthis)
downloadthis::download_file("demo.gpkg" ,button_label = "להורדה")
```

## תהליך העבודה - שלב 1

-   נתקין qneat, פלאגין לסיוע בניתוח רשתי
-   נשתמש ברשת מוכנה מראש לחישוב:
    -   מרחקים על רשת הדרכים
    -   זמני הליכה ללא טופוגרפיה
    -   זמני הליכה עם טופוגרפיה

## התקנת qneat - עזר לתוצר

![](images/paste-6.png)

------------------------------------------------------------------------

## ![](images/paste-7.png){width="748"}

------------------------------------------------------------------------

![](images/paste-8.png)

## חישוב ללא עכבות טופוגרפיות

מהקובץ אותו הורדנו, נפתח את פרויקט plain

נפתח את כלי הiso-areas, וממנו את **Iso-Area as Pointcloud (from Layer)**

![](images/paste-9.png)

## המון פרמטרים! מה חשוב?

הרשת - Network Layer

שכבת ההתחלה + מזהה ייחודי של נקודה Startpoint Layer + Unique Point ID Field (numerical)

סף עליון של מטרים לחישוב Maximum cost level for Iso-Area

סוג החישוב (**מסלול קצר** או מסלול מהיר ביותר) optimization criterion

סוג הכניסה לרשת (משפיע מאוד על מהירות החישוב) entry cost calculation method

## תוצר

![](images/paste-10.png)

## Iso-areas אחרים - דוגמאות

הדגמה חיה.

## חישוב מתוקנן מהירות

ניתן לעשות שימוש בשדה נוסף אחד בלבד - speed, שערך ברירת המחדל שלו הוא 5 קמ"ש, ולשנות את optimization criterion למסלול מהיר ביותר, בשביל לקבל בחזרה את כל הערכים בצורה של דקות.

## חישוב מתוקנן טופוגרפיה

### נוסחת טובלר

<https://en.wikipedia.org/wiki/Tobler%27s_hiking_function>

כבר "הכנתי" את הרשת ככפולת לינקים, כאשר כיוון אחד מקבל ערך מהירות אחד, וכיוון אחר - ערך מהירות שני.

## תהליך העבודה - שלב 2

-   נראה איך נראית רשת מלוכלכת
-   נלמד איך להתמודד איתה
-   נגיע לתוצר ללא טופוגרפיה

## רשת מלוכלכת - הדגמה

## תהליך ניקוי רשת - הצעה

![](images/paste-13.png)

## הוספת מוצאים/יעדים

על פי ההיגיון, למשל - לפעמים חכם לחבר לרשת קיימת.

## תבחין הניקוי

-   הגיון בריא

-   topology checker

-   הסתכלות מרחבית כוללת

## תהליך העבודה - שלב 3

-   נראה איך נראית שכבת גבהים
-   נלמד להטמיע אותה ברשת
-   נלמד לחשב שיפועים עם מנוע הביטויים
-   נגיע לתוצר עם טופוגרפיה

## DEM

שכבה רסטרית שמכילה גבהים ברזולוציה מסוימת

![](images/paste-14.png){width="547"}

------------------------------------------------------------------------

## תיקון של dem חסר

למה חסר?

r.fillnulls (bilinear)

![](images/paste-15.png){width="644"}

## הטמעת ערכי גובה ברשת

drape z

## שיפוע ממוצע

מנוע הביטויים - צלילה פנימה

## נוסחת טובלר

מנוע הביטויים - צלילה עוד יותר פנימה

## הפיכת הרשת לדו כיוונית

שימוש בreverse, merge